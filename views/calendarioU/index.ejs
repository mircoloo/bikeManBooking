<style>
    table {
      font-family: arial, sans-serif;
      border-collapse: collapse;
      width: 80%;
    }
    
    td, th {
      border: 1px solid #dddddd;
      text-align: left;
      padding: 8px;
    }
    
    tr:nth-child(even) {
      background-color: #dddddd;
    }

    hr {
      width: 80%;
      margin-left: 0
    }
</style>

<script type="text/javascript">
  function load() {
    let d = new Date().toISOString().slice(0,10)
    document.getElementById("data").value = d
    document.getElementById("nuovaP").defaultValue = d
    document.getElementById("nuovaP").min = d
    loadPren(d)
  }
  window.onload = load;

  function goPrev() {
    let m = new Date(document.getElementById("data").value)
    m.setDate(m.getDate()-1)
    document.getElementById("data").value = m.toISOString().slice(0,10)

    document.getElementById("tbody").innerHTML = ""
    loadPren(m.toISOString().slice(0,10))
  }
  function goNext() {
    let m = new Date(document.getElementById("data").value)
    m.setDate(m.getDate()+1)
    document.getElementById("data").value = m.toISOString().slice(0,10)

    document.getElementById("tbody").innerHTML = ""
    loadPren(m.toISOString().slice(0,10))
  }

  function loadPren(day) {
    const heading = document.getElementById('tbody')
    const list = document.createDocumentFragment()

    getData(calendario/prenotazioni?data=${day}).then((v) => {
      v.prenotazione.map(function(p) {
        tr = document.createElement('tr')
        data = document.createElement('td')
        utente = document.createElement('td')
        problema = document.createElement('td')
        bici = document.createElement('td')

        data.innerHTML = ${p.data.slice(0,10)}
        utente.innerHTML = ${p.utente}
        problema.innerHTML = ${p.problema}
        bici.innerHTML = ${p.bici}

        tr.appendChild(data)
        tr.appendChild(utente)
        tr.appendChild(problema)
        tr.appendChild(bici)

        list.appendChild(tr)
      })

      heading.appendChild(list)
    })
    .catch(function(error) {
      console.log(error)
    })
  }
  async function getData(url) {
    const res = await fetch(url)
    const data = await res.json()

    return data
  }
</script>

<h2>Trova prenotazioni per giorno</h2>

<label>Seleziona la data</label>
<input type="date" name="data" value="" id="data"></input>
<button onclick="go()">Stampa prenotazioni</button>

<button onclick="goPrev()" id="prev">Prev</button>
<button onclick="goNext()" id="next">Next</button>

<hr>
<table>
  <thead>
    <tr>
      <th>Data prenotazione</th>
      <th>Utente</th>
      <th>Problema</th>
      <th>Bici</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>


<br><br>
<hr>


<h2>Prenota la tua manutenzione</h2>
<form action="/calendario" method="POST">
    <label>Data </label>
    <input type="date" name="data" value="" id="nuovaP"></input>
    <br>
    <label>Utente </label>
    <input type="text" name="utente" value="" required></input>
    <br>
    <label>Problema </label>
    <input type="text" name="problema" value="" required></input>
    <br>
    <label>Bici </label>
    <input type="text" name="bici" value="" required></input>
    <br>
    <button type="reset">Annulla</button>
    <button type="submit">Crea prenotazione</button>
</form>

